{% include 'toolbar-admin.html' %}


{% block header %}
<header class="jumbotron">
  <div class="row row-header">
      <div class="col">
        <div class="alert alert-info">
          <small>Last Model Refresh: <strong><em>{{last_model_refresh}}. </em></strong> Species: <em>Amur Tiger, Bengal Tiger, Cheetah, Leopard, Puma, African Lion, African Elephant, Black Rhino, White Rhino, Lowland Tapir, Bongo, Otter.</em> </small>
        </div>
      </div>
  </div>
</header>

    
{% endblock %}

{% block content %}  
    <div class="container-fluid">
        <div class="table-responsive">
            <table  
                id="imagetable" class="table table-striped table-sm" 
                data-locale="en-US"
                data-toggle="table"
                data-search="true"
                data-show-refresh="true"
                data-show-toggle="true"
                data-show-fullscreen="true"
                data-show-columns="true"
                data-show-columns-toggle-all="true"
                data-show-export="true"
                data-pagination="true"
                data-side-pagination="server"
                data-show-jump-to="true"
                data-id-field="ID"
                data-escape="false"
                data-undefined-text=""
                data-page-list="[10,25, 50, 100, all]"
                data-url="get_artifacts"
                data-height="650">
                <thead>
                    <tr>
                        <th rowspan="2" data-field="annotated_image" data-formatter="ModalLinkFormatter" data-valign="middle">Image</th>
                        <th rowspan="2" data-field="Individual" data-visible="true" data-valign="middle" data-editable="true"
                        data-editable-type="text" data-editable-emptytext="Click to Edit">Individual</th>
                        <th rowspan="2" data-field="Rating" data-valign="middle" data-editable="true"
                        data-editable-type="select" data-editable-source="get_ratingscale" data-editable-emptytext="Click to Edit">Rating</th>
                        <th rowspan="2" data-field="ExpertComments" data-valign="middle" data-editable="true"
                        data-editable-type="text" data-editable-emptytext="Click to Edit">WildTrack Comments</th>
                        <th colspan="3" data-halign="center">AI Information</th>
                        <th colspan="5" data-halign="center">Recorder Information</th>
                        <th rowspan="2" data-field="ID" data-visible="false">ID</th>
                    </tr>
                    <tr>
                        <th data-valign="middle" data-visible="false" data-field="AI_Use">AI Use</th>
                        <th data-valign="middle" data-visible="false" data-field="Reference">Ref</th>
                        <th data-valign="middle" data-visible="true"data-field="Individual_Inference">Individual</th>
                        <th data-field="TimeStamp" data-valign="middle">Date</th>
                        <th data-field="Name" data-valign="middle" data-editable="true"
                        data-editable-type="text" data-editable-emptytext="Click to Edit">Name</th>
                        <th data-field="Organization" data-visible="false" data-valign="middle" data-editable="true"
                        data-editable-type="text" data-editable-emptytext="Click to Edit">Organization</th>
                        <th data-field="UserComments" data-valign="middle">Comments</th>
                        <th data-field="Source" data-valign="middle">Source</th>
                         </tr>
                </thead>
            </table>
        </div>
    
    <!-- Modal style="width:95%; height:95%; margin:20px auto" -->
    <div id="ModalDetails" class="modal fade ">
        <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable modal-xl" >
            <!-- Modal content-->
            <div class="modal-content">
                <div class="modal-header text-center d-block">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <h4 class="modal-title">Image Detail</h4>

                </div>
                <div class="modal-body">
                  <div id="ModalSummary">
                        <div class="table-responsive">
                            <table id="detailtable" class="table table-sm" 
                            data-locale="en-US"
                            data-toggle="table"
                            data-escape="false">
                            </table>
                        </div>
                    </div>
                    <div>
                        <form id="DetailsForm" >
                            <div class="form-group row">
                                <label for="rating" class="col-md-2 col-form-label">Image Quality</label>
                                <div class="col-md-6">
                                    <div class="form-check form-check-inline">
                                        <input class="form-check-input" type="radio" id="qone" name="rating" value="1">
                                        <label class="form-check-label" for="one">1</label>
                                    </div>
                                    <div class="form-check form-check-inline">
                                        <input class="form-check-input" type="radio" id="qtwo" name="rating" value="2">
                                        <label class="form-check-label" for="one">2</label>
                                    </div>
                                    <div class="form-check form-check-inline">
                                        <input class="form-check-input" type="radio" id="qthree" name="rating" value="3">
                                        <label class="form-check-label" for="one">3</label>
                                    </div>
                                    <div class="form-check form-check-inline">
                                        <input class="form-check-input" type="radio" id="qfour" name="rating" value="4">
                                        <label class="form-check-label" for="one">4</label>
                                    </div>
                                    <div class="form-check form-check-inline">
                                        <input class="form-check-input" type="radio" id="qfive" name="rating" value="5">
                                        <label class="form-check-label" for="one">5</label>
                                    </div>
                                    </div> 
                            </div>
        
                            <div class="form-group row">
                                <label for="comments" class="col-md-2 col-form-label">Comments</label>
                                <div class="col-md-10">
                                    <textarea class="form-control" id="comments" name="comments" 
                                    placeholder="Comments on Image" 
                                    rows="12"></textarea>   
                                </div>                       
                            </div>
                            <div class="form-group row">
                                <label for="MLType" class="col-md-2 col-form-label">Modeling Use</label>
                                <div class="col-md-3">
                                    <div class="form-check">
                                        <input type="checkbox" class="form-check-input" id="reference" name="reference" value="reference">
                                        <label class="form-check-label" for="approve">
                                            Reference Image
                                        </label>
                                    </div>
                                </div>   
                                <div class="col-md-6">
                                    <div class="form-check form-check-inline">
                                        <input class="form-check-input" type="radio" id="mltrain" name="mltype" value="Training Set">
                                        <label class="form-check-label" for="one">Training Set</label>
                                    </div>
                                    <div class="form-check form-check-inline">
                                        <input class="form-check-input" type="radio" id="mltest" name="mltype" value="Test Set">
                                        <label class="form-check-label" for="one">Test Set</label>
                                    </div>
                                </div>   
                            </div>
                            <div class="form-group row">
                                <div class="offset-md-2 col-md-10">
                                    <button type="button" class="btn btn-secondary" data-dismiss="modal">
                                        Cancel
                                    </button>
                                    <button type="submit" class="btn btn-primary">
                                        Save
                                    </button>
                                </div>                      
                            </div>
                        </form>
                    </div>
                </div>

            </div>
        </div>
    </div>
</div>

<script>
    var $detailtable = $('#detailtable');
    var $currentID;

    function ModalLinkFormatter(value, row, index) {
        console.log(row)
        //var linktext='<a href=\"javascript:void(0)\" onclick=\"launchModal(\''+JSON.stringify(row)+'\')\">'+value+'</a>'
        var linktext='<a href=\"javascript:void(0)\" onclick=\"launchModal(\''+row["ID"]+'\')\">'+value+'</a>'
        //var linktext='<a href=\"javascript:void(0)\" onclick=\"launchModal(\'5efce6c33d65356d5097593c\')\">'+value+'</a>'
        //var linktext='<a href=\"javascript:void(0)\" onclick=\"launchModal(2)\">'+value+'</a>'
        //console.log(linktext);
        return linktext;
    }

    function launchModal(ID) {
        //console.log(row)
        //var ID=row["ID"]
        //console.log($table.bootstrapTable('getRowByUniqueId', ID))
        //var current_sighting=$table.bootstrapTable('getRowByUniqueId', ID)
        //var detail_url='get_details/?sightingID='+ID
        //var detail_url='get_details'
        //var imagesource=$("#imagetable").bootstrapTable('getRowByUniqueId',ID)
        //console.log(ID)
        //console.log(value)
        detail_url='get_images/?artifactID='+ID;
        $currentID=ID;
        //console.log(detail_url)
        
        $("#detailtable").bootstrapTable('destroy').bootstrapTable({
        columns: [
            {
            title: 'Image',
            field: 'image',
            align: 'center',
            valign: 'middle',
            }, {
            title: 'Annotated Image',
            field: 'annotated_image',
            align: 'center',
            valign: 'middle'
            }
        ],
        url:detail_url,
        });

        $("#ModalDetails").modal();
        //console.log(current_sighting)
        };
    
    $('#DetailsForm').on('submit', function(e){
        e.preventDefault();
        console.log($currentID);
        $.ajax({
            url:'/update_image_details',
            type:'post',
            data:$('#DetailsForm').serialize(),
            success:function(){
                console.log("OK");
                $('#ModalDetails').modal('hide');
                $('#DetailsForm').trigger("reset");

                },
            error:function(error){
                console.log(error);
                $('#fModalDetails').modal('hide');
                $('#DetailsForm').trigger("reset");
                    }
            });
        });


    $("#imagetable").on('editable-save.bs.table', function(editable, field, row, oldValue, $el) {
        //console.log("editable:", editable);
        console.log("field:", field);
        console.log("row", row[field],row["ID"]);
        console.log("oldValue", oldValue);
        //console.log("el", $el);
        var update_data={"ID":row["ID"],"Field":field,"Value":row[field]};
        var update_url='/update_artifact_details';
        //console.log(comment_data);
        $.ajax({
          type: 'POST',
                url: update_url,
                data: update_data,
                success: function(response){
                    console.log(response);
                },
                error: function(error){
                    console.log(error);
                }
            });
    });
</script>
{% endblock %} 